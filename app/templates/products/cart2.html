<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Order Page</title>
  <style>
    /* Sample styles for demonstration */
    .form-group {
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
<h2>Order Page</h2>

<div class="form-group">
  <label for="comment">Comment:</label>
  <textarea id="comment" name="comment"></textarea>
</div>

<div class="form-group">
  <label for="cashType">Cash Type:</label>
  <select id="cashType" name="cashType">
    <option value="cash">Cash</option>
    <option value="card">Card</option>
  </select>
</div>

<div class="form-group">
  <label for="deliveryOption">Delivery Option:</label>
  <select id="deliveryOption" name="deliveryOption">
    <option value="yes">Yes</option>
    <option value="no">No</option>
  </select>
</div>

<div class="form-group">
  <label for="address">Select Address:</label>
  <select id="address" name="address">
    <!-- Options will be dynamically added here -->
  </select>
</div>

<div class="form-group">
  <label for="selectedAddress">Selected Address:</label>
  <span id="selectedAddress"></span>
</div>

<div class="form-group">
  <label for="branch">Branch:</label>
  <span id="branch"></span>
</div>

<div class="form-group">
  <label for="minDistance">Minimum Distance:</label>
  <span id="minDistance">0 km</span>
</div>

<div class="form-group">
  <label for="cost">Cost:</label>
  <input type="number" id="cost" name="cost" value="0" readonly>
</div>

<div class="form-group">
  <label for="deliveryCost">Delivery Cost:</label>
  <input type="number" id="deliveryCost" name="deliveryCost" value="0" readonly>
</div>

<div class="form-group">
  <label for="totalAmount">All Amount:</label>
  <input type="number" id="totalAmount" name="totalAmount" value="0" readonly>
</div>

<script>
  // Sample outlet data
  const outletBranches = [
    {name: "Outlet 1", latitude: 40.730610, longitude: -73.935242},
    {name: "Outlet 2", latitude: 40.741939, longitude: -73.989723},
    {name: "Outlet 3", latitude: 40.748817, longitude: -73.985428}
  ];

  // Sample address data (replace with actual API fetching)
  const addresses = [
    {id: 1, name: "Address 1", latitude: 40.730610, longitude: -73.935241},
    {id: 2, name: "Address 2", latitude: 40.741939, longitude: -73.989723},
    {id: 3, name: "Address 3", latitude: 40.748817, longitude: -73.985428}
  ];

  // Function to calculate distance between two points using Haversine formula
  function calculateDistance(lat1, lon1, lat2, lon2) {
    const earthRadiusKm = 6371;
    const latDiff = toRadians(lat2 - lat1);
    const lonDiff = toRadians(lon2 - lon1);
    const a = Math.sin(latDiff / 2) * Math.sin(latDiff / 2) +
      Math.cos(toRadians(lat1)) * Math.cos(toRadians(lat2)) *
      Math.sin(lonDiff / 2) * Math.sin(lonDiff / 2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    const distance = earthRadiusKm * c;
    return distance;
  }

  // Function to convert degrees to radians
  function toRadians(degrees) {
    return degrees * Math.PI / 180;
  }

  // Sample user location
  const userLatitude = 40.7128;
  const userLongitude = -74.0060;

  // Find the closest outlet branch
  let minDistance = Infinity;
  let closestOutlet = null;
  outletBranches.forEach(branch => {
    const distance = calculateDistance(userLatitude, userLongitude, branch.latitude, branch.longitude);
    if (distance < minDistance) {
      minDistance = distance;
      closestOutlet = branch;
    }
  });

  // Validate minimum distance
  if (minDistance > 100) {
    document.getElementById('branch').innerText = "Error: No branch within 100 km.";
  } else {
    document.getElementById('branch').innerText = closestOutlet.name;
  }

  // Populate address dropdown
  const addressSelect = document.getElementById('address');
  addresses.forEach(address => {
    const option = document.createElement('option');
    option.value = address.id;
    option.textContent = address.name;
    addressSelect.appendChild(option);
  });

  // Event listener for address selection
  addressSelect.addEventListener('change', function () {
    const selectedAddress = addresses.find(address => address.id === parseInt(this.value));
    document.getElementById('selectedAddress').innerText = selectedAddress ? selectedAddress.name : '';

    // Calculate and update minimum distance if an address is selected
    if (selectedAddress) {
      const addressLatitude = selectedAddress.latitude;
      const addressLongitude = selectedAddress.longitude;
      let minDistance = Infinity;
      let closestOutlet = null;
      outletBranches.forEach(branch => {
        const distance = calculateDistance(addressLatitude, addressLongitude, branch.latitude, branch.longitude);
        if (distance < minDistance) {
          minDistance = distance;
          closestOutlet = branch;
        }
      });

      // Validate minimum distance
      if (minDistance > 100) {
        document.getElementById('branch').innerText = "Error: No branch within 100 km.";
      } else {
        document.getElementById('branch').innerText = closestOutlet.name;
      }

      // Update minimum distance label
      document.getElementById('minDistance').innerText = minDistance.toFixed(2) + " km";
    } else {
      document.getElementById('minDistance').innerText = "0 km";
      document.getElementById('branch').innerText = "";
    }
  });

  // Calculate and update cost
  const cost = 100; // Example cost
  document.getElementById('cost').value = cost;

  // Calculate and update delivery cost based on delivery option
  const deliveryOption = document.getElementById('deliveryOption').value;
  const deliveryCost = deliveryOption === 'yes' ? 10 : 0; // Example delivery cost
  document.getElementById('deliveryCost').value = deliveryCost;

  // Calculate and update total amount
  const totalAmount = cost + deliveryCost;
  document.getElementById('totalAmount').value = totalAmount;
</script>
</body>
</html>
